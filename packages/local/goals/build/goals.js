Ext.define("Goals.overrides.form.field.Tag",{override:"Ext.form.field.Tag",fieldSubTpl:['<div id="{cmpId}-listWrapper" style="min-height: 4px;" data-ref="listWrapper" class="'+Ext.baseCSSPrefix+'tagfield {fieldCls} {typeCls} {typeCls}-{ui}">','<ul id="{cmpId}-itemList" data-ref="itemList" class="'+Ext.baseCSSPrefix+'tagfield-list">','<li id="{cmpId}-inputElCt" data-ref="inputElCt" style="margin: 1px 4px 0 0;" class="'+Ext.baseCSSPrefix+'tagfield-input">','<div id="{cmpId}-emptyEl" data-ref="emptyEl" class="{emptyCls}" style="padding-top: 0px; padding-left: 3px; color: rgb(172, 172, 172);">{emptyText}</div>','<input id="{cmpId}-inputEl" data-ref="inputEl" type="{type}" ','<tpl if="name">name="{name}" </tpl>','<tpl if="value"> value="{[Ext.util.Format.htmlEncode(values.value)]}"</tpl>','<tpl if="size">size="{size}" </tpl>','<tpl if="tabIdx != null">tabIndex="{tabIdx}" </tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','class="'+Ext.baseCSSPrefix+'tagfield-input-field {inputElCls}" autocomplete="off">',"</li>","</ul>","</div>",{disableFormats:true}],onItemListClick:function(d){var c=this,a=c.selectionModel,b=d.getTarget(c.tagItemSelector),f=b?d.getTarget(c.tagItemCloseSelector):false;if(c.readOnly||c.disabled){return}d.stopPropagation();if(b){if(f){c.removeByListItemNode(b);if(c.valueStore.getCount()>0){c.fireEvent("select",c,c.valueStore.getRange())}}else{c.toggleSelectionByListItemNode(b,d.shiftKey)}if(!Ext.supports.TouchEvents){c.inputEl.focus()}}else{if(a.getCount()>0){a.deselectAll()}c.emptyEl.addCls("x-form-empty-field");c.inputEl.removeCls("x-tagfield-emptyinput");c.inputEl.focus();if(c.triggerOnClick){}}},constructor:function(){this.callParent(arguments);this.on("change",function(){this.applyEmptyText()})}});Ext.define("Goals.overrides.form.trigger.ClearTrigger",{extend:"Ext.form.trigger.Trigger",alias:"trigger.cleartrigger",cls:Ext.baseCSSPrefix+"form-clear-trigger",mixins:{observable:"Ext.util.Observable"},hideWhenEmpty:true,hideWhenMouseOut:false,clearOnEscape:false,destroy:function(){this.clearListeners();this.callParent()},initEvents:function(){this.updateTriggerVisibility();this.callParent();var b=this.field;if(this.hideWhenEmpty){this.addManagedListener(b,"change",this.updateTriggerVisibility,this)}if(this.hideWhenMouseOut){var a=b.bodyEl;this.addManagedListener(a,"mouseover",function(){this.mouseover=true;this.updateTriggerVisibility()},this);this.addManagedListener(a,"mouseout",function(){this.mouseover=false;this.updateTriggerVisibility()},this)}if(this.clearOnEscape){this.addManagedListener(b.inputEl,"keydown",function(c){if(c.getKey()===Ext.event.Event.ESC){if(b.isExpanded){return}this.handler(b);c.stopEvent()}},this)}},updateTriggerVisibility:function(){if(this.isTriggerVisible()){if(!this.isVisible()){this.show()}}else{if(this.isVisible()){this.hide()}}},handler:function(a){if(Ext.isFunction(a.clearValue)){a.clearValue()}else{a.setValue("")}},isTriggerVisible:function(){if(!this.field||!this.rendered||this.isDestroyed){return false}if(this.hideWhenEmpty&&Ext.isEmpty(this.field.getValue())){return false}if(this.hideWhenMouseOut&&!this.mouseover){return false}return true}});Ext.define("Goals.model.ExecutiveGridModel",{extend:"Ext.data.Model",fields:["name","targetDate","duration","taskId"]});Ext.define("Goals.model.ExecutiveModel",{extend:"Ext.data.Model",fields:["description",{name:"targetdate",convert:function(a){if(a){return new Date(a)}else{return""}}},"taskcompleted","taskid","timerequired"]});Ext.define("Goals.model.GoalsParentComboModel",{extend:"Ext.data.Model",alias:"model.goalparentcombo",fields:["goalname","goalid"]});Ext.define("Goals.model.GoalsStatusComboModel",{extend:"Ext.data.Model",alias:"model.goalstatuscombo",fields:["statusname","statusid"]});Ext.define("Goals.model.GoalsViewModel",{extend:"Ext.data.Model",alias:"model.goalviewmodel",fields:[{name:"name"},{name:"title"},{name:"targetdate"},{name:"goalstatus"},{name:"goalType"},{name:"goalAllView",convert:function(b,a){if(b){return b}else{if(Utility.goalsArray.indexOf(a.data.goalid)==-1){Utility.goalsArray.push(a.data.goalid);return true}else{return false}}}}]});Ext.define("Goals.model.NotesModel",{extend:"Ext.data.Model",fields:["details","ddo_goalnote_id","goalid","notetype","targetdate"]});Ext.define("Goals.model.Rating",{extend:"Ext.data.Model",alias:"model.rating",fields:["imagepath","name","rating"]});Ext.define("Goals.model.ShareGroup",{extend:"Ext.data.Model",alias:"model.sharegroup",fields:[{name:"employeeid"},{name:"name"},{name:"shareid"},{name:"userprofilepic"}]});Ext.define("Goals.store.ExecutiveGridStore",{extend:"Ext.data.Store",alias:"store.executivegridstore",requires:["Goals.model.ExecutiveGridModel"],model:"Goals.model.ExecutiveGridModel",autoLoad:true,proxy:{type:"ajax",url:"/resources/data/griddata.json",reader:{type:"json",rootProperty:"data"}}});Ext.define("Goals.store.ExecutiveStore",{extend:"Ext.data.Store",alias:"store.executivestore",requires:["Goals.model.ExecutiveModel"],model:"Goals.model.ExecutiveModel",autoLoad:false,proxy:{type:"ajax",url:"/goal/detail",reader:{type:"json",rootProperty:"data.executionPlanData"},actionMethods:{read:"GET"}}});Ext.define("Goals.store.GoalsNotesStore",{extend:"Ext.data.Store",alias:"store.goalsnotesstore",requires:["Goals.model.NotesModel"],model:"Goals.model.NotesModel",autoLoad:false,proxy:{type:"ajax",url:"/goalnote",reader:{type:"json",rootProperty:"data"}}});Ext.define("Goals.store.RatingStore",{extend:"Ext.data.Store",alias:"store.ratingstore",requires:["Goals.model.Rating"],autoLoad:true,model:"Goals.model.Rating",proxy:{type:"ajax",url:"/resources/data/goalrating.json",reader:{type:"json",rootProperty:"data"}}});Ext.define("Goals.store.ShareGroups",{extend:"Ext.data.Store",alias:"store.sharegroups",requires:["Goals.model.ShareGroup"],autoLoad:false,model:"Goals.model.ShareGroup",proxy:{type:"ajax",url:"/sharegoal",reader:{type:"json",rootProperty:"data"}}});Ext.define("Goals.store.goals.GoalsParentComboStore",{extend:"Ext.data.Store",alias:"store.goalsparentcombo",requires:["Goals.model.GoalsParentComboModel"],model:"Goals.model.GoalsParentComboModel",autoLoad:false,proxy:{type:"ajax",url:"/sharegoal",reader:{type:"json",rootProperty:"data"},actionMethods:{read:"GET"}}});Ext.define("Goals.store.goals.GoalsStatusComboStore",{extend:"Ext.data.Store",alias:"store.goalsstatuscombo",requires:["Goals.model.GoalsStatusComboModel"],model:"Goals.model.GoalsStatusComboModel",autoLoad:false,proxy:{type:"ajax",url:"/goalstatus",reader:{type:"json",rootProperty:"data"},actionMethods:{read:"GET"}}});Ext.define("Goals.store.goals.GoalsStore",{extend:"Ext.data.Store",alias:"store.goalsstore",autoLoad:true,proxy:{type:"ajax",url:"/resources/data/goals/goalsstore.json",reader:{type:"json",rootProperty:"data"}}});Ext.define("Goals.store.goals.GoalsViewStore",{extend:"Ext.data.Store",alias:"store.goalsviewstore",requires:["Goals.model.GoalsViewModel"],model:"Goals.model.GoalsViewModel",autoLoad:false,proxy:{type:"ajax",url:"/goal/allgoals",reader:{type:"json",rootProperty:"data"}},listeners:{load:function(){Utility.goalsArray=[]}}});Ext.define("Goals.store.goals.ProjectStore",{extend:"Ext.data.Store",alias:"store.projectstore",requires:[],autoLoad:false,proxy:{type:"ajax",url:"/resources/data/goals/projectstore.json",reader:{type:"json",rootProperty:"data"}}});Ext.define("Goals.view.ExecutivePlanForm",{extend:"Ext.form.Panel",alias:"widget.executiveplanform",layout:{type:"fit"},maxHeight:250,requires:["Goals.store.ExecutiveStore"],items:[{xtype:"grid",bind:{disabled:"{GridDisable}"},disabledCls:"goal-gridcls",maxHeight:239,columnLines:true,viewConfig:{stripeRows:false},plugins:{ptype:"cellediting",clicksToEdit:1,autoCancel:false,listeners:{edit:function(f,e,d){var a=Ext.widget("executiveplanview"),b=a.getViewModel(),c=b.get("goaldate")||Ext.ComponentQuery.query("#targetdateid")[0];if((c&&c.rawValue!="")||null){e.record.set("date",Utility.goaldate)}}}},bbar:[{xtype:"button",text:"Add New Task",cls:"goalsaddbtn-cls",bind:{hidden:"{addTaskDisable}"},iconCls:"x-fa fa-plus",handler:"onAddTaskClick"}],cls:"goalsgrid-cls",store:"Goals.store.ExecutiveStore",columns:[{xtype:"checkcolumn",menuDisabled:true,sortable:false,dataIndex:"taskcompleted",bind:{hidden:"{!istodoDelete}"},listeners:{checkchange:"oncheckchange"},flex:0.2},{xtype:"actioncolumn",menuDisabled:true,bind:{hidden:"{istodoDelete}"},flex:0.1,items:[{icon:"../resources/images/goals/delete.png",margin:10,tooltip:"Delete",cls:"goaldelete-cls",handler:function(e,h,c){var b=Ext.getStore("Goals.store.ExecutiveStore"),d=Ext.ComponentQuery.query("executiveplanview")[0],g=d.getViewModel(),a=b.getAt(h),f;f={taskIds:a.data.taskid};if(a&&a.data.taskid){Ext.Ajax.request({url:Api.URL.goaltask.DELETE,method:"DELETE",params:f,success:function(p,j){b.removeAt(h);b.load({params:{goalId:g.get("ddo_employeegoal_id")}});var n=Ext.ComponentQuery.query("executiveplanmainview")[0],l=n.lookupReference("executiveplanviewref"),m=l.lookupReference("execapprovalref"),i=l.lookupReference("executiveplanformRef"),k=i.down("grid"),o=k.getStore();if(o.getCount()<=0){m.setDisabled(true)}Ext.getBody().unmask()},failure:function(j,i){Ext.getBody().unmask()}})}else{b.remove(a)}},getClass:function(b,d,e,f,c,a){if(e.data.deletable==false){return"hideDisplay"}else{if(e.data.deletable){return"showDisplay"}}}}]},{xtype:"gridcolumn",text:"Task",emptyText:"Task Name",editor:{xtype:"textarea",allowBlank:false,height:50,width:470},dataIndex:"description",flex:1,renderer:function(a){if(a===null||a===undefined||a==""){return'<div style="color:lightgrey;text-align:left;margin-top:10px;">Create Task</div>';return a}else{return'<div style="text-align:left;">'+a+"</div>"}}},{xtype:"widgetcolumn",text:"Target Date",dataIndex:"targetdate",flex:0.6,widget:{xtype:"datefield",allowBlank:false,cls:"goalsdate-cls",itemId:"goaldtfieldref",readOnly:true,emptyText:"Date",format:"d-m-Y",fieldCls:"goaldateicon-cls"},editor:{xtype:"datefield",allowBlank:false,editable:false,emptyText:"Date",itemId:"targetdateid",minValue:new Date(),format:"d-m-Y",bind:{maxValue:"{targetDate}"},listeners:{select:function(c){var a=Ext.ComponentQuery.query("executiveplanview")[0],b=a.getViewModel();Utility.goaldate=c.rawValue}},createPicker:function(){var a=this,b=Ext.String.format;return Ext.create("Ext.picker.Date",{pickerField:a,ownerCt:a.ownerCt,renderTo:document.body,floating:true,hidden:true,focusOnShow:true,cls:"ddo-create-datepicker",minDate:a.minValue,maxDate:a.maxValue,disabledDatesRE:a.disabledDatesRE,disabledDatesText:a.disabledDatesText,disabledDays:a.disabledDays,disabledDaysText:a.disabledDaysText,format:a.format,showToday:a.showToday,startDay:a.startDay,minText:b(a.minText,a.formatDate(a.minValue)),maxText:b(a.maxText,a.formatDate(a.maxValue)),listeners:{scope:a,select:a.onSelect},keyNavConfig:{esc:function(){a.collapse()}}})}}},{xtype:"widgetcolumn",text:"Duration",dataIndex:"timerequired",flex:0.4,widget:{xtype:"numberfield",allowBlank:false,cls:"goalsdate-cls",fieldCls:"goalhoursicon-cls",emptyText:"Hrs",readOnly:true},editor:{xtype:"numberfield",allowBlank:false,emptyText:"Hrs",fieldCls:"goalhoursicon-cls",hideTrigger:true}}],width:400}]});Ext.define("Goals.view.ExecutivePlanHeader",{extend:"Ext.form.Panel",alias:"widget.executiveplanheader",requires:["Ext.form.trigger.Trigger","Goals.overrides.form.trigger.ClearTrigger"],layout:{type:"hbox",align:"middle"},defaults:{margin:10},items:[{layout:"vbox",defaults:{width:650,labelSeparator:""},items:[{xtype:"textfield",cls:"header-fields-design",fieldLabel:"Goal Name",name:"goalname",emptyText:"Goal Name"},{xtype:"combo",reference:"parentgoalref",fieldLabel:"Parent Goal",emptyText:"Parent Goal",cls:"header-combo-fields-design",store:"Goals.store.goals.GoalsParentComboStore",valueField:"goalid",displayField:"goalname",triggerAction:"all",editable:false,triggers:{clear:{cls:"ddo-trigger-clear x-form-clear-trigger",type:"cleartrigger",weight:-1,hideWhenEmpty:true}},bind:{readOnly:"{goalFieldReadyOnly}"},listeners:{change:function(d,b,a,c){if(b){d.setValue(b)}}}}]},{layout:"vbox",defaults:{labelSeparator:"",cls:"header-fields"},items:[{layout:"hbox",items:[{html:"Progress",width:100},{xtype:"panel",width:130,margin:"0 2 8 0",items:[{xtype:"progressbar",ui:"goalprogressbar",value:0}]},{xtype:"label",margin:"0 0 0 10",cls:"progress-header",html:"0%",listeners:{render:"setProgressBarValue"}}]},{xtype:"datefield",name:"targetDate",width:260,minValue:new Date(),fieldLabel:"Target Date",format:"d-m-Y",formatText:null,editable:false,bind:{readOnly:"{goalFieldReadyOnly}"},listeners:{change:function(d){var b,c,a;b=d.rawValue;a=Ext.ComponentQuery.query("executiveplanview")[0];if(a&&b){a.getViewModel().set("targetDate",d.getValue())}}},createPicker:function(){var a=this,b=Ext.String.format;return Ext.create("Ext.picker.Date",{pickerField:a,ownerCt:a.ownerCt,renderTo:document.body,floating:true,hidden:true,focusOnShow:true,cls:"ddo-create-datepicker",minDate:a.minValue,maxDate:a.maxValue,disabledDatesRE:a.disabledDatesRE,disabledDatesText:a.disabledDatesText,disabledDays:a.disabledDays,disabledDaysText:a.disabledDaysText,format:a.format,showToday:a.showToday,startDay:a.startDay,minText:b(a.minText,a.formatDate(a.minValue)),maxText:b(a.maxText,a.formatDate(a.maxValue)),listeners:{scope:a,select:a.onSelect},keyNavConfig:{esc:function(){a.collapse()}}})}}]}]});Ext.define("Goals.view.goals.GoalsController",{extend:"Ext.app.ViewController",alias:"controller.goalscontroller",onGoalClick:function(f,c,j,g,h,a){var e=this,d=h.getTarget(),i=Ext.get(d),b;if(i.hasCls("create-goal-cls")||i.getParent().hasCls("create-goal-plus-icon")||i.hasCls("create-goal-text")){this.onGoalWindowView(f,c,j,g,h,a)}else{if(i.hasCls("goal-status-cls")||i.getParent().hasCls("goals-dashboard-cls")||i.hasCls("goals-dashboard-cls")||i.getParent().hasCls("goals-header-cls")||i.getParent().hasCls("goals-title-cls")||i.getParent().hasCls("goals-karmascore-cls")||i.getParent().hasCls("goals-user-name")||i.getParent().hasCls("goals-target-date-cls")||i.hasCls("goals-status-icon")||i.hasCls("goal-status-text")){this.onGoalViewLoad(f,c,j,g,h,a)}}},onGoalWindowView:function(f,d,j,g,h,a){var i=Ext.ComponentQuery.query("goalsmainview")[0],c=i.up().getLayout(),e=Ext.ComponentQuery.query("executiveplanview")[0],b=e.down("tabpanel");this.onClearingGoalsWindow();b.setActiveTab(0);c.setActiveItem(0)},onGoalViewLoad:function(l,a,t,p,o,n){this.onClearingGoalsWindow();var j=Ext.ComponentQuery.query("goalsmainview")[0],s=j.up().getLayout();var k=Ext.ComponentQuery.query("executiveplanmainview")[0],g=Ext.ComponentQuery.query("sharegoalsform")[0],c=k.lookupReference("executiveplanheaderref"),r=k.lookupReference("executiveplanviewref"),m=r.down("textarea[reference = commentsratingref]"),w=r.down("tabpanel"),u=r.getViewModel(),b=Ext.getStore("login").getData(),f=b.items[0].data.ddo_employee_id,v=c.down("textfield[name=goalname]"),i=c.down("combo[reference=parentgoalref]"),h=r.down("container[name=measurementCriteria]"),q=r.down("textarea[reference=commentsref]"),d=c.down("datefield[name=targetDate]"),e=a.data.isManager;u.set("tab2",false);u.set("ddo_employeegoal_id",a.data.goalid);u.set("ddo_employeegoal_userid",a.data.goalUser.employeeId);u.set("empkarmaPoints",a.data.karmapoints);u.set("selectedKarmapoints",a.data.karmapoints);if(e){if(a.data.goalUser.employeeId==f){u.set("BtnText","Save");u.set("approveText","Request Approval")}else{u.set("BtnText","Move To Drafts");u.set("approveText","Approve")}}m.setValue(null);Ext.Ajax.request({url:"/goal/detail",method:"GET",params:{goalId:a.data.goalid},success:function(N,ai){console.log("resp",N);var C=Ext.decode(N.responseText),ac=Ext.ComponentQuery.query("notes")[0],D=ac.down("grid"),J=C.data.notes,T=D.getStore(),F=r.lookupReference("executiveplanformRef"),I=F.down("button[text=Add New Task]"),ab=F.down("grid"),R=ab.getStore(),P=C.data.executionPlanData,U;var E=w.down("managerratingform"),W=E.down("numberfield[reference=goalKarmaPoints]"),G=E.down("numberfield[reference=valuesuperb]"),af=E.down("numberfield[reference=valuegood]");W.setValue(null);G.setValue(null);af.setValue(null);var K=w.down("container[reference=ratingref]"),Z=K.down("button[reference=dnebtnref]"),z=K.down().getLayout();z.setActiveItem(0);var X=C.data.goalstatusname.replace(/ /,"-").toLowerCase().trim().concat("-icon-cls");k.getViewModel().set("goalStatus",C.data.goalstatusname);k.getViewModel().set("goalStatusIconCls",X);v.setValue(C.data.goaltitle);U=C.data.targetdate;var ad=i.getStore(),O=ad.findRecord("goalid",C.data.parentgoalid);if(a.data.goalUser.employeeId==f){if(O){i.setValue(C.data.parentgoalid)}}else{i.setValue(C.data.parentgoalname)}d.setValue(Ext.Date.format(new Date(U),"Y-m-d"));h.setValue(C.data.measurementcriteria);var A=0,Q=0,B=0;for(var ae=0;ae<P.length;ae++){var x={taskid:P[ae].taskid,description:P[ae].description,targetdate:P[ae].targetdate,timerequired:P[ae].timerequired,taskcompleted:P[ae].taskcompleted};R.add(x);if(P[ae].taskcompleted){A=A+P[ae].timerequired}Q=Q+P[ae].timerequired}var M=P.length;if(M>0){var B=(A/Q)}var V=c.down("progressbar");var H=c.down("label");V.setValue(B);H.setHtml(Math.round((B*100),2)+"%");if(B==1){u.set("isdoneBtnEnable",false)}else{u.set("isdoneBtnEnable",true)}for(var ae=0;ae<J.length;ae++){var L={details:J[ae].details,ddo_goalnote_id:J[ae].noteid,notetype:J[ae].type,targetdate:new Date(J[ae].notetargetdate)};T.add(L)}var aa=[],S=g.down("tagfield");C.data.shareData.forEach(function(ak){var aj=ak.employeeid;aa.push(aj);Utility.goalsharetaggedList.push(aj)});var y=S.getStore();y.clearFilter(true);y.load({scope:this,callback:function(){S.setValue(aa);y.filterBy(function(aj){if(aa.indexOf(aj.data.employeeid)==-1){return true}else{return false}})}});if(C.data.goalstatusname=="Pending"){u.set("isUpdateNeed",true);k.getViewModel().set("goalFieldReadyOnly",true);u.set("BtnvisibilityMode",true);u.set("editorOrGridDisable",true);u.set("addTaskDisable",true);u.set("GridDisable",true);u.set("isUpdateNeed",false);u.set("dneBtn",true);D.setDisabled(true);R.each(function(aj){aj.set("deletable",false)});if(a.data.goalUser.employeeId!=f){u.set("tab4",false);u.set("MngrVisibilityMode",true);u.set("EmpVisibilityMode",true);u.set("visibilityMode",false);u.set("BtnvisibilityMode",false);u.set("ratingIconsEnable",true);u.set("readOnlyKarmafield",false);u.set("amziconDisabled",false);q.setValue("");m.setValue("")}}else{if(C.data.goalstatusname=="Re-Open"){u.set("apprvedisabled",false)}else{if(C.data.goalstatusname=="In Progress"){u.set("tab3",false);u.set("tab4",false);u.set("editorOrGridDisable",true);k.getViewModel().set("goalFieldReadyOnly",true);u.set("GridDisable",false);u.set("BtnvisibilityMode",true);u.set("addTaskDisable",true);u.set("doneText","Complete");u.set("isUpdateNeed",true);u.set("dneBtn",false);u.set("istodoDelete",true);m.setEmptyText("Self Comments");u.set("EmpVisibilityMode",false);u.set("MngrVisibilityMode",true);W.setValue(C.data.goalkarmapoints);if(!Ext.isEmpty(C.data.goalkarmapoints)){var ah=C.data.goalkarmapoints;G.setValue(ah*2/3);af.setValue(ah*1/3)}if((a.data.goalUser.employeeId!=f)){u.set("dneBtn",true);u.set("GridDisable",true);u.set("tab4",false);u.set("tab3",true);u.set("EmpVisibilityMode",true);u.set("visibilityMode",true);u.set("BtnvisibilityMode",true);D.setDisabled(true)}else{if(u.get("isManager")){u.set("isUpdateNeed",true);u.set("dneBtn",false);u.set("EmpVisibilityMode",false);u.set("MngrVisibilityMode",false);u.set("doneText","Done")}}R.each(function(aj){aj.set("deletable",false)})}else{if(C.data.goalstatusname=="Completed"){u.set("tab3",false);u.set("tab4",false);var E=w.down("managerratingform"),W=E.down("numberfield[reference=goalKarmaPoints]");W.setValue(C.data.goalkarmapoints);if(!Ext.isEmpty(C.data.goalkarmapoints)){var G=E.down("numberfield[reference=valuesuperb]");var af=E.down("numberfield[reference=valuegood]");var ah=C.data.goalkarmapoints;G.setValue(ah*2/3);af.setValue(ah*1/3)}R.each(function(aj){aj.set("deletable",false)});k.getViewModel().set("goalFieldReadyOnly",true);u.set("editorOrGridDisable",true);u.set("addTaskDisable",true);u.set("GridDisable",true);u.set("isUpdateNeed",true);u.set("dneBtn",true);u.set("BtnvisibilityMode",true);u.set("EmpVisibilityMode",true);if(a.data.goalUser.employeeId!=f){u.set("tab3",true);k.getViewModel().set("goalFieldReadyOnly",true);u.set("editorOrGridDisable",true);u.set("GridDisable",true);u.set("isUpdateNeed",true);u.set("dneBtn",true);u.set("MngrVisibilityMode",false);u.set("EmpVisibilityMode",false);u.set("BtnvisibilityMode",true);u.set("isUpdateNeed",true);u.set("dneBtn",false);u.set("ratingIconsEnable",true);u.set("doneText","Done");m.setValue("")}}else{if(C.data.goalstatusname=="Achieved"){var ag=C.data.rating;u.set("tab1",false);u.set("tab2",false);u.set("tab3",false);u.set("tab4",false);k.getViewModel().set("goalFieldReadyOnly",true);u.set("editorOrGridDisable",true);u.set("addTaskDisable",true);u.set("GridDisable",true);u.set("isUpdateNeed",true);u.set("dneBtn",true);u.set("MngrVisibilityMode",true);u.set("EmpVisibilityMode",true);u.set("BtnvisibilityMode",true);if(ag.length>0){u.set("achievedKarmaPoints",ag[0].earnedpoints);u.set("achievedratingText",ag[0].ratingtext);K.down("dataview[reference =selfcommentsref]").setData(ag)}var Y=K.down("ratingdetails").down("dataview");z.setActiveItem(1);if(u.get("isManager")){u.set("tab4",true)}R.each(function(aj){aj.set("deletable",false)});if(a.data.goalUser.employeeId!=f){u.set("tab3",true)}}else{if(C.data.goalstatusname=="Cancel"){var ag=C.data.rating;u.set("tab1",false);u.set("tab2",false);u.set("tab3",true);u.set("tab4",false);u.set("shareReadOnly",true);k.getViewModel().set("goalFieldReadyOnly",true);u.set("editorOrGridDisable",true);u.set("addTaskDisable",true);u.set("GridDisable",true);u.set("isUpdateNeed",true);u.set("dneBtn",true);u.set("MngrVisibilityMode",true);u.set("EmpVisibilityMode",true);u.set("BtnvisibilityMode",true);if(ag.length>0){u.set("achievedKarmaPoints",ag[0].earnedpoints);u.set("achievedratingText",ag[0].ratingtext);K.down("dataview[reference =selfcommentsref]").setData(ag)}}else{if(C.data.goalstatusname=="Draft"){k.getViewModel().set("goalFieldReadyOnly",true);u.set("editorOrGridDisable",false);u.set("GridDisable",false);D.setDisabled(false);R.each(function(aj){aj.set("deletable",true)});u.set("isUpdateNeed",false);u.set("istodoDelete",false);u.set("addTaskDisable",false);u.set("BtnText","Save");if(u.get("isManager")){u.set("approveText","Start");u.set("addTaskDisable",false)}}else{k.getViewModel().set("goalFieldReadyOnly",true);u.set("editorOrGridDisable",false);u.set("addTaskDisable",false);u.set("GridDisable",false);D.setDisabled(false);R.each(function(aj){aj.set("deletable",true)});u.set("isUpdateNeed",false);u.set("istodoDelete",false);u.set("BtnText","Save")}}}}}}}w.setActiveTab(0);s.setActiveItem(0)},failure:function(y,x){}})},onClearingGoalsWindow:function(){var m=Ext.ComponentQuery.query("goalsmainview")[0],d=m.up().getLayout(),c=Ext.getStore("login").getData(),a=c.items[0].data,e;isManager=false;a.reportingto=(a.reportingto==0)?null:a.reportingto;if(Ext.isEmpty(a.reportingto)){isManager=true}else{isManager=false}Utility.goalsharetaggedList=[];var h=Ext.ComponentQuery.query("executiveplanheader")[0];var k=Ext.ComponentQuery.query("executiveplanview")[0],f=Ext.ComponentQuery.query("executiveplanmainview")[0],j=k.getViewModel(),l=f.getViewModel(),b=k.down("tabpanel");h.getForm().reset();var i=h.down("progressbar");var g=h.down("label");i.setValue(0);g.setHtml("0%");b.down("htmleditor[name=measurementCriteria]").reset();b.down("executiveplanform").down("grid").getStore().removeAll();b.down("executiveplanform").down("grid");b.down("sharegoalsform").down("tagfield").reset();b.down("notes").down("grid").getStore().removeAll();j.set("tab2",true);j.set("tab3",true);j.set("tab4",true);j.set("tab5",false);j.set("editorOrGridDisable",false);j.set("addTaskDisable",false);j.set("GridDisable",false);j.set("visibilityMode",true);j.set("BtnvisibilityMode",false);j.set("istodoDelete",false);j.set("apprvedisabled",true);j.set("ratingIconsEnable",false);j.set("BtnText","Save");j.set("ddo_employeegoal_id",null);j.set("selectedKarmapoints",null);j.set("readOnlyKarmafield",true);j.set("amziconDisabled",true);j.set("empkarmaPoints",null);j.set("seletcedRatingText",null);j.set("achievedKarmaPoints",null);j.set("achievedratingText","");j.set("approveText","Request Approval");j.set("isManager",false);l.set("goalFieldReadyOnly",false);j.set("achievedkarma",null);if(isManager==true){j.set("approveText","Start");j.set("isManager",true)}approvalBtn=k.down("button[reference = approveBtnRef]");e=k.down("button[reference = execapprovalref]");if(!approvalBtn.isDisabled()||!e.isDisabled()){approvalBtn.setDisabled(true);e.setDisabled(true)}l.set("goalStatusIconCls","draft-icon-cls");l.set("goalStatus","Draft")}});Ext.define("Goals.view.goals.SearchGoalViewController",{extend:"Ext.app.ViewController",alias:"controller.searchgoalviewcontroller",onSearchGoalFliter:function(b,d,a){var c=Ext.ComponentQuery.query("searchfilterwindow")[0]||Ext.create("Goals.view.goals.SearchFilterWindow");c.show()},onLabelFocus:function(b,c,a){b.getEl().on("click",function(t,n,p){var r=Ext.ComponentQuery.query("goalsheader")[0],o=r.down("combobox[reference = comboref]"),f=o.getStore().findRecord("value",o.getValue()),m=Ext.getStore("Goals.store.goals.GoalsViewStore"),i=Ext.getStore("login").getData(),l=i.items[0].data.ddo_employee_id,k;if(f==null){k=Ext.ComponentQuery.query("combobox[name=goaltypecombo]")[1];f=o.getStore().findRecord("value",k.getValue())}if(m){m.clearFilter(true);m.filterBy(function(v){var u=false,e=f.data;if(v.data.goalType==e.key){if((e.key=="Shared")&&(v.data.goalUser.employeeId==l)){u=false}else{u=true}}else{if((e.key=="All")&&v.data.goalAllView){u=true}else{if(v.data.goalType==e.key=="Team"){u=true}else{if(v.data.goalType=="Shared"){if((e.key=="Personal")&&(v.data.goalUser.employeeId==l)){u=true}else{u=false}}}}}return u},this)}var r=Ext.ComponentQuery.query("goalsheader")[0],s=r.down("button[reference=searchfiltericon]"),q=r.down("label[reference=clearfilterRef]");var d=Ext.ComponentQuery.query("searchfilterwindow")[0]||Ext.create("Goals.view.goals.SearchFilterWindow"),j=d.down("buttongroup[reference=btnGrpRef]"),g=d.down("datefield[reference=fromDate]"),h;d.getViewModel().set("filterView",false);if(s.el&&s.el.hasCls("searchgoal-selected-icon-field")){s.el.removeCls("searchgoal-selected-icon-field");s.el.addCls("searchgoal-icon-field")}j.items.items.forEach(function(e){if(e.pressed){e.pressed=false;e.addCls("goals-btn-cls");e.removeCls("pressedBtnCls")}});h=d.down("form");h.reset();g.setValue("");if(!q.hasCls("x-hidden")){q.addCls("x-hidden")}})},oncomborender:function(c,b){var d=c.getStore(),a=d.getAt(0);c.setValue(a)},onComboSelect:function(f,i,j){var m=f.selection,g=m.data,k=Ext.widget("goalsview"),b=k.getStore(),d=false;var a=Ext.ComponentQuery.query("searchfilterwindow")[0],c=Ext.getStore("login").getData(),h=c.items[0].data.ddo_employee_id;if(a){d=a.getViewModel().get("filterView")}if(d){var l=a.down("button[reference=filtersearchbtn]");a.getController().onGoalsFliter(l,null,null,true)}else{b.clearFilter(true);b.filterBy(function(e){if(e.data.goalType==g.key){if((g.key=="Shared")&&(e.data.goalUser.employeeId==h)){return false}else{return true}}else{if((g.key=="All")&&e.data.goalAllView){return true}else{if(e.data.goalType==g.key=="Team"){return true}else{if(e.data.goalType=="Shared"){if((g.key=="Personal")&&(e.data.goalUser.employeeId==h)){return true}else{return false}}else{return false}}}}})}}});Ext.define("Goals.view.goals.GoalsView",{extend:"Ext.view.View",alias:"widget.goalsview",requires:["Goals.view.goals.GoalsController","Goals.view.goals.SearchGoalViewController"],cls:"goals-dashboard-view-cls noscrollbar",scrollable:"y",initComponent:function(){Ext.getStore("Goals.store.goals.GoalsViewStore").load();Ext.getStore("Goals.store.goals.GoalsParentComboStore").load();var a=Ext.getStore("settings.GoalSettings");if(!a.isLoaded()){a.load()}this.callParent(arguments)},loadMask:false,controller:"goalscontroller",store:"Goals.store.goals.GoalsViewStore",tpl:['<tpl if="this.getGoals(values)">','<div class="create-goal-cls" id="{[this.setId(values)]}">','<div class="create-goal-plus-icon"><span class="plus-icon"></span></div>','<div class="create-goal-text">Create Goal</div>',"</div>","<tpl else>",'<tpl for=".">','<span class="goals-dashboard-main-cls">','<tpl if="xindex === 1">','<div class="create-goal-cls">','<div class="create-goal-plus-icon"><span class="plus-icon"></span></div>','<div class="create-goal-text">Create Goal</div>',"</div>","</tpl>",'<div class="goals-dashboard-cls">','<div class="goals-header-cls">','<div class="goals-dash-img-cls">','<img class="goals-dash-user-icon" src={[this.getUserPic(values)]}>',"</div>",'<div class="goals-user-name">',"<span>{goalUser.name}</span>","</div>",'<div class="goals-target-date-cls">',"<span>Target Date:</span>","<br/>","<span>{[this.getTargetDateFormat(values)]}</span>","</div>","</div>",'<div class="goals-title-cls">',"<span>{title}</span>","</div>",'<div class="goal-status-cls">','<span><img class="goals-status-icon" src="{[this.getStatusIcon(values)]}" width="80px" height="80px"></span>',"<br />",'<span class="goal-status-text">{goalstatus}</span>',"</div>",'<tpl if="this.getStatusName(values)">','<div class="goals-progress-cls">','<meter class="goals-progress-meter-cls" value={[this.getStatusPerIcon(values)]} min=0 max=100></meter>','<span class="goals-progress-meter-value">{[this.getStatusPerIcon(values)]}%</span>',"</div>","</tpl>",'<div class="goals-karmascore-cls">','<tpl if="this.getKarma(values)">','<span class="karma-score-icon"></span>','<span class="goals-kamra-score">{karmapoints}</span>',"</tpl>","</div>","</div>","</div>","</div>","</span>","</tpl>","</tpl>",{setId:function(a){var b;b="input_goals_id";Ext.Function.defer(this.addListener,2,this,[b,a]);return b},addListener:function(b,a){if(!Ext.isEmpty(Ext.get(b))&&!Ext.get(b).hasListener("blur")){Ext.get(b).on("click",function(f,d){var g=Ext.ComponentQuery.query("goalsview")[0];g.getController().onGoalWindowView()},this)}},getTargetDateFormat:function(b){var c=b.targetdate,a=Ext.Date.format(new Date(c),"m-d-Y");return a},getStatusIcon:function(a){if(a.goalstatus=="In Progress"){return"resources/images/goals/inprogress.png"}else{if(a.goalstatus=="Draft"){return"resources/images/goals/drafted.png"}else{if(a.goalstatus=="Completed"){return"resources/images/goals/complete.jpg"}else{if(a.goalstatus=="Pending"){return"resources/images/goals/pending.jpg"}else{if(a.goalstatus=="Cancel"){return"resources/images/goals/close_green.png"}else{return"resources/images/goals/amazing.png"}}}}}},getStatusPerIcon:function(b){var a=b.percentage;return a},getStatusName:function(b){var a=b.goalstatus;if(a=="In Progress"){return true}},getGoals:function(a){return Ext.isEmpty(a)},getUserPic:function(a){var b=a.goalUser.userProfilePic;if(!Ext.isEmpty(b)){return b}},getKarma:function(b){var c=b.karmapoints,a=b.goalstatus;if(c!=null&&a=="Achieved"){return true}}}],itemSelector:".goals-dashboard-main-cls",listeners:{itemclick:"onGoalClick"}});Ext.define("Goals.view.Notes",{extend:"Ext.form.Panel",alias:"widget.notes",layout:{type:"fit"},requires:["Goals.store.GoalsNotesStore"],items:[{xtype:"grid",disabledCls:"goal-gridcls",maxHeight:400,height:400,columnLines:true,viewConfig:{stripeRows:false},emptytext:"No Records Found",cls:"notesgrid-cls",store:"Goals.store.GoalsNotesStore",columns:[{xtype:"gridcolumn",text:"Note Type",cls:"notetype-cls",dataIndex:"notetype",flex:0.5,renderer:function(a){if(a=="Standard"){var b="resources/images/goals/standard.png";return'<span><img width = "20px" height= "20px" src="'+b+'" /></span> <span>'+a+"</span>"}else{if(a=="Re-Open"){var b="resources/images/goals/undo.png";return'<span><img width = "20px" height= "20px" src="'+b+'" /></span> <span>'+a+"</span>"}else{if(a=="Cancel"){var b="resources/images/goals/close.png";return'<span><img width = "20px" height= "20px" src="'+b+'" /></span> <span>'+a+"</span>"}else{var b="resources/images/goals/goalstats.png";return'<span><img width = "20px" height= "20px" src="'+b+'" /></span> <span>'+a+"</span>"}}}}},{xtype:"gridcolumn",text:"Comment",emptyText:"Comment",value:"Lorem Ipsum",dataIndex:"details",flex:1},{xtype:"gridcolumn",text:"Created Date",dataIndex:"targetdate",flex:0.6,renderer:function(b){if(b){var a=Ext.Date.format(new Date(b),"d-M-Y");return a}else{return""}}}],width:400}]});Ext.define("Goals.view.RatingForm",{extend:"Ext.view.View",alias:"widget.goalratingform",margin:50,store:"Goals.store.RatingStore",emptyText:'<div class = "ddo-karmasetup-emptytext">No Icons Added</div>',tpl:['<span style="position:relative;bottom: 150px;font-size:16px;color:grey">Assigned Karma:</span>','<tpl for=".">','<div class="karmasetup-main-cls">','<div style="background: #fff;text-align: center;padding-top: 10%;border-radius: 4px;box-shadow: 2px 2px 2px 0px #c9c7c8;width:100px;height:100px;">','<img src="{imagepath}" class="ddo-karmasetup-icon" wrap-td="image_url">',"</div>",'<div style="text-align:center;color: #c6c6c6;width: 100px;padding: 18px 0px 10px 0px;border: none;background: transparent;border-bottom: 1px solid #afafaf;font-size: 16px;">{name}</div>','<div style="text-align:center;color: #c6c6c6;width: 100px;padding: 12px 0px 0px 0px;border: none;background: transparent;font-size: 16px;">{rating}</div>',"</div>","</tpl>"],itemSelector:"karmasetup-main-cls",listeners:{itemclick:"karmaSetupItemClick",itemkeyup:"onKarmaIconItemKeyUp"}});Ext.define("Goals.view.ShareGoalsForm",{extend:"Ext.container.Container",alias:"widget.sharegoalsform",requires:["Goals.store.ShareGroups","Goals.overrides.form.field.Tag"],layout:{type:"hbox"},initComponent:function(){var a=Ext.getStore("Goals.store.ShareGroups");if(!a.isLoaded()){a.load()}this.callParent(arguments)},width:"100%",items:[{xtype:"tagfield",width:"100%",margin:20,cls:"sharegroup-cls",reference:"tagscomboview",anyMatch:true,editable:true,matchFieldWidth:false,hideTrigger:true,forceSelection:false,store:"karmasetup.wallet.EmployeeComboStore",emptyText:"select employee",displayField:"empname",valueField:"empid",queryMode:"local",filterPickList:true,listConfig:{cls:"tag-view-list",width:300},tpl:['<ul class="x-list-plain"><tpl for=".">','<li role="option" class="x-boundlist-item">','<div class="ddo-tag-round">{[this.getTags(values)]}</div>','<div class="ddo-tag-Name">{empname}</div></li>',"</tpl>","</ul>",{getTags:function(a){if(typeof(a)==="object"){if(a.profilepic){return'<img class="tagUrl-img"  src="'+a.profilepic+'" >'}}}}],listeners:{select:function(c,a,b){c.inputEl.dom.value="";c.collapse()}}}]});Ext.define("Goals.view.ManagerRatingForm",{extend:"Ext.form.Panel",alias:"widget.managerratingform",xtype:"managerratingform",cls:"manager-rating-form",width:"100%",height:"100%",bodyPadding:40,layout:{type:"hbox"},items:[{html:"Assigned Karma:",width:120},{xtype:"container",margin:"0 20 0 0",layout:{type:"vbox",align:"middle"},items:[{xtype:"container",cls:"karmastatusPic",bind:{disabled:"{amziconDisabled}"},height:120,width:120,padding:"0 0 0 2",value:"Amazing",bind:{style:{background:'url("/resources/images/goals/amazing.png")',"background-repeat":"no-repeat","background-position":"center","background-color":"white"}},layout:{type:"vbox"},listeners:{render:"onGoalsIconRender"}},{html:"Amazing",bind:{disabled:"{amziconDisabled}"},reference:"activeRatingText",margin:"10 0 10 0"},{xtype:"numberfield",width:120,bind:{disabled:"{amziconDisabled}",readOnly:"{readOnlyKarmafield}"},cls:"header-fields-design",hideTrigger:true,reference:"goalKarmaPoints",listeners:{blur:"calculateKarma"}}]},{xtype:"container",margin:"0 20 0 0",layout:{type:"vbox",align:"middle"},items:[{xtype:"container",cls:"karmastatusPic",bind:{disabled:"{supiconDisabled}"},height:120,width:120,padding:"0 0 0 2",value:"Superb",listeners:{render:"onGoalsIconRender"},bind:{style:{background:'url("/resources/images/goals/superb.png")',"background-repeat":"no-repeat","background-position":"center","background-color":"white"}},layout:{type:"vbox"}},{html:"Superb",bind:{disabled:"{supiconDisabled}"},margin:"10 0 10 0"},{xtype:"numberfield",reference:"valuesuperb",readOnly:true,bind:{disabled:"{supiconDisabled}"},allowDecimals:false,cls:"header-fields-design",hideTrigger:true,width:120}]},{xtype:"container",margin:"0 20 0 0",layout:{type:"vbox",align:"middle"},items:[{xtype:"container",bind:{disabled:"{goodiconDisabled}"},cls:"karmastatusPic",height:120,width:120,value:"Good",padding:"0 0 0 2",bind:{style:{background:'url("/resources/images/goals/good.png")',"background-repeat":"no-repeat","background-position":"center","background-color":"white"}},layout:{type:"vbox"},listeners:{render:"onGoalsIconRender"}},{html:"Good",bind:{disabled:"{goodiconDisabled}"},margin:"10 0 10 0"},{xtype:"numberfield",readOnly:true,bind:{disabled:"{goodiconDisabled}"},allowDecimals:false,reference:"valuegood",cls:"header-fields-design",hideTrigger:true,width:120}]}]});Ext.define("Goals.view.ExecutivePlanViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.executiveplanview",data:{tab2:true,tab3:true,tab4:true,tab5:true,tab1:false,shareReadOnly:false,isUpdateNeed:false,ddo_employeegoal_id:null,ddo_employeegoal_userid:null,empkarmaPoints:null,editorOrGridDisable:false,GridDisable:false,visibilityMode:true,BtnvisibilityMode:false,EmpVisibilityMode:true,BtnText:null,doneText:null,approveText:null,isdoneBtnEnable:false,istodoDelete:false,MngrVisibilityMode:true,dneBtn:true,apprvedisabled:true,amziconDisabled:true,supiconDisabled:true,goodiconDisabled:true,targetDate:null,isManager:false,ratingIconsEnable:false,readOnlyKarmafield:true,selectedKarmapoints:null,achievedkarma:null,seletcedRatingText:null,achievedKarmaPoints:null,achievedratingText:"",addTaskDisable:false,loginEmpId:null}});Ext.define("Goals.view.ExecutivePlanViewController",{extend:"Ext.app.ViewController",alias:"controller.executiveplanview",onAddTaskClick:function(e){var d=e.up("grid"),c=d.getStore(),a={description:"",targetdate:"",timerequired:"",deletable:true},f=c.getCount(),b;c.each(function(g){b=g;b.set("deletable",true)});c.add(a)},onBackButtonClick:function(){Ext.getStore("Goals.store.goals.GoalsViewStore").load();this.getView().up().getLayout().setActiveItem(1)},onMeasurementSave:function(i,q,c){var k=Ext.ComponentQuery.query("executiveplanmainview")[0],f=k.lookupReference("executiveplanheaderref"),m=k.lookupReference("executiveplanviewref"),u=m.getViewModel(),x=m.down("tabpanel"),n=m.down("hiddenfield"),v=f.down("textfield[name=goalname]"),h=m.down("container[name=measurementCriteria]"),l=m.down("textarea[reference=commentsref]"),g=f.down("datefield[name=targetDate]"),j=f.down("combo[reference=parentgoalref]"),p=j.getValue(),d=g.getValue(),t=Ext.Date.format(d,"Y-m-d"),b=Ext.getStore("Goals.store.GoalsNotesStore"),a=Ext.getStore("Goals.store.goals.GoalsViewStore"),r=h.getValue(),o=v.getValue(),s=u.get("ddo_employeegoal_id"),y=[],w=l.getValue();a.each(function(e){y=e.data.isManager});if(i.text=="Move To Drafts"){statusId=6;this.onMovetoDraftTxt(i,b,statusId,s,w)}else{if(Ext.isEmpty(d)){Ext.Msg.alert("Warning","Please fill target date");return false}if(Ext.isEmpty(r)){Ext.Msg.alert("Warning","Please fill measurement criteria");return false}if(Ext.isEmpty(o)){Ext.Msg.alert("Warning","Please fill goal name");return false}params={parentGoalId:p,goalname:o,targetDate:t,measurementCriteria:r};if(u.get("ddo_employeegoal_id")){params.empGoalId=u.get("ddo_employeegoal_id");Ext.Ajax.request({url:Api.URL.goal.UPDATE,method:"PUT",params:params,scope:this,success:function(z,e){u.set("tab2",false);u.set("apprvedisabled",true);Ext.defer(function(){x.setActiveTab(1)},500);a.load()},failure:function(z,e){}})}else{Ext.Ajax.request({url:Api.URL.goal.CREATE,method:"POST",params:params,scope:this,success:function(A,e){var z=Ext.decode(A.responseText);u.set("ddo_employeegoal_id",z.ddo_employeegoal_id);u.set("ddo_employeegoal_userid",z.ddo_employee_id);u.set("tab2",false);Ext.defer(function(){x.setActiveTab(1)},500);a.load()},failure:function(z,e){}})}}},onMovetoDraftTxt:function(b,g,h,c,a){if(Ext.isEmpty(a)){Ext.Msg.alert("Warning","Please fill comments");return false}var d=Ext.ComponentQuery.query("executiveplanview")[0],e=Ext.ComponentQuery.query("executiveplanmainview")[0],j=d.getViewModel(),i=e.getViewModel(),f={goalId:c,statusId:h,noteDetails:a};Ext.Ajax.request({url:"/goalstatus",method:"PUT",params:f,scope:this,success:function(l,k){i.set("goalStatus","Re-Open");i.set("goalStatusIconCls","draft-icon-cls");j.set("visibilityMode",true);j.set("BtnvisibilityMode",true);j.set("isUpdateNeed",true);j.set("dneBtn",true);Ext.Msg.alert("Success","Goal is re-opened");g.load({params:{goalid:c}})},failure:function(l,k){}})},onExecutivePlanSave:function(n,v,f){var p=Ext.ComponentQuery.query("executiveplanmainview")[0],i=p.lookupReference("executiveplanheaderref"),r=p.lookupReference("executiveplanviewref"),h=r.lookupReference("execapprovalref"),o=i.down("combo[reference=parentgoalref]"),z=r.getViewModel(),t=o.getValue(),m=r.lookupReference("executiveplanformRef"),b=m.down("grid"),C=b.getStore(),c=Ext.getStore("Goals.store.GoalsNotesStore"),a=Ext.getStore("Goals.store.goals.GoalsViewStore"),j=i.down("datefield[name=targetDate]"),g=j.getValue(),y=Ext.Date.format(g,"Y-m-d"),A=i.down("textfield[name=goalname]"),s=A.getValue(),x=z.get("ddo_employeegoal_id"),A=i.down("textfield[name=goalname]"),s=A.getValue(),l=r.down("container[name=measurementCriteria]"),q=r.down("textarea[reference=commentsref]"),w=l.getValue(),d=Ext.getStore("Goals.store.ExecutiveStore"),B=q.getValue(),j=i.down("datefield[name=targetDate]"),g=j.getValue(),y=Ext.Date.format(g,"Y-m-d"),u,k=[];if(n.text=="Move To Drafts"){statusId=6;this.onMovetoDraftTxt(n,c,statusId,x,B)}else{if(Ext.isEmpty(s)){Ext.Msg.alert("Warning","Please fill goal name");return false}else{if(C.getCount()>0){u=C.data.items;u.forEach(function(e){if(!Ext.isEmpty(e.get("timerequired"))&&!Ext.isEmpty(e.get("description"))&&!Ext.isEmpty(e.get("targetdate"))){taskItems={name:e.get("description"),targetDate:Ext.Date.format((e.get("date")),"Y-m-d")||Ext.Date.format((e.get("targetdate")),"Y-m-d"),duration:e.get("timerequired"),goalId:x,taskId:e.get("taskid")};k.push(taskItems)}});if(k.length>0){Ext.Ajax.request({url:Api.URL.goaltask.CREATE,method:"POST",params:{goalTask:Ext.encode(k),empGoalId:x,goalname:s,parentGoalId:t,targetDate:y},success:function(D,e){Ext.Msg.alert("Status","Your execution plans saved successfully");h.setDisabled(false);d.load({params:{goalId:z.get("ddo_employeegoal_id")}});a.reload()},failure:function(D,e){}})}else{Ext.Msg.alert("Alert","Please enter all mandatory fields")}}else{Ext.Msg.alert("Alert","Please add task")}}}},onShareUpdate:function(h,o,a){var j=Ext.ComponentQuery.query("executiveplanmainview")[0],d=j.lookupReference("executiveplanheaderref"),k=j.lookupReference("executiveplanviewref"),q=k.getViewModel(),r=q.get("ddo_employeegoal_id"),f=d.down("datefield[name=targetDate]"),c=f.getValue(),p=Ext.Date.format(c,"Y-m-d"),s=d.down("textfield[name=goalname]"),n=s.getValue(),i=d.down("combo[reference=parentgoalref]"),m=i.getValue(),u=Ext.ComponentQuery.query("sharegoalsform")[0],t=u.down("tagfield[reference=tagscomboview]"),l=t.getStore(),b=t.getValueRecords(),g=[];if(!Ext.isEmpty(Utility.goalsharetaggedList)||b.length>0){if(b.length>0){b.forEach(function(e){tagIds={employeeId:e.data.empid,goalId:r};g.push(tagIds)})}Ext.Ajax.request({url:"/sharegoal",method:"POST",params:{empGoalId:r,goalname:n,parentGoalId:m,targetDate:p,shareData:Ext.encode(g)||Ext.encode(Utility.goalsharetaggedList)},success:function(v,e){if(b.length>0){Ext.Msg.alert("Success","Goal shared to selected members");Ext.getStore("Goals.store.goals.GoalsParentComboStore").load();Utility.goalsharetaggedList.push(b)}else{Ext.Msg.alert("Success","Successfully Goal share updated");Ext.getStore("Goals.store.goals.GoalsParentComboStore").load();Utility.goalsharetaggedList=[]}},failure:function(v,e){}})}else{Ext.Msg.alert("Warning","Please select employee to share.")}},onAddNewClick:function(b,f,a){var d=Ext.ComponentQuery.query("goalsnotewindow")[0]||Ext.create("Goals.view.goals.GoalsNoteWindow"),c=d.down("form");c.reset();d.show()},calculateKarma:function(f){var e=this.getView().down("numberfield[reference=valuesuperb]");var a=this.getView().down("numberfield[reference=valuegood]");var b=Ext.ComponentQuery.query("executiveplanview")[0].getViewModel();var c=f.value;b.set("selectedKarmapoints",c);var d=this.getView().down("button[text=Approve]");e.setValue(c*2/3);a.setValue(c*1/3);d.enable();if(f.value==null||0){d.disable()}},onApproveBtnClick:function(b,h){var i,g,m,l,k,n,f;var d=Ext.ComponentQuery.query("executiveplanmainview")[0],j=Ext.ComponentQuery.query("executiveplanview")[0],c=j.down("tabpanel"),o=c.down("container[reference=ratingref]"),a=o.down("button[reference=dnebtnref]");i=b.statusId;l=this.getView();k=l.getReferences();m=this.getViewModel();g=m.get("ddo_employeegoal_id");n=k.activeRatingText.config.html;f=k.goalKarmaPoints.getValue();if(f){Ext.Ajax.request({url:"/goalstatus",method:"PUT",params:{goalId:g,statusId:i,ratingText:n,karmaPoints:f},success:function(e,p){Ext.Msg.alert("Success"," Successfully Goal approved");d.getViewModel().set("goalStatus","In Progress");d.getViewModel().set("goalStatusIconCls","in-progress-icon-cls");d.getViewModel().set("isUpdateNeed",true);d.getViewModel().set("dneBtn",false);j.getViewModel().set("BtnvisibilityMode",true);j.getViewModel().set("visibilityMode",true)},failure:function(e,p){var q=Ext.decode(e.responseText).message;Ext.Msg.alert("Error!",q)}})}else{Ext.Msg.alert("Error!","Please fill the karma points")}},onDraftsBtnClick:function(b,i){var j,g,l,m=Ext.getStore("Goals.store.goals.GoalsViewStore"),h=Ext.getStore("Goals.store.GoalsNotesStore"),f=Ext.ComponentQuery.query("executiveplanview")[0],c=Ext.ComponentQuery.query("executiveplanmainview")[0],k=c.getViewModel(),n=f.getViewModel(),d=f.down("textarea[reference=commentsref]"),a=d.getValue();j=b.statusId;l=this.getViewModel();g=l.get("ddo_employeegoal_id");if(Ext.isEmpty(a)){Ext.Msg.alert("Warning","Please fill comments");return false}Ext.Ajax.request({url:"/goalstatus",method:"PUT",params:{goalId:g,statusId:j,noteDetails:a},success:function(e,o){k.set("goalStatus","Re-Open");k.set("goalStatusIconCls","draft-icon-cls");n.set("visibilityMode",true);n.set("BtnvisibilityMode",true);n.set("isUpdateNeed",true);n.set("dneBtn",true);Ext.Msg.alert("Success","Goal is re-Opened");h.load({params:{goalid:g}})},failure:function(e,o){Ext.Msg.alert("Error!","Failed to update the goal status!")}})},onCompleteBtnClick:function(c,j){var k,f,m,o;k=c.statusId;m=this.getViewModel();f=m.get("ddo_employeegoal_id"),goalOwner=m.get("ddo_employeegoal_userid"),karmapoints=m.get("empkarmaPoints"),ratingText=m.get("seletcedRatingText"),isManager=m.get("isManager"),loginStoreData=Ext.getStore("login").getData(),loginData=loginStoreData.items[0].data;if(loginData.ddo_employee_id!=goalOwner){isManager=false}var d=Ext.ComponentQuery.query("executiveplanmainview")[0],l=d.lookupReference("executiveplanviewref"),b=l.down("textarea[reference = commentsratingref]"),n=Ext.getStore("Goals.store.goals.GoalsViewStore"),i=l.down("radiogroup"),h=i.getValue(),g=h.rb,a=b.getValue();if(c.text=="Done"){k=5;karmapoints=m.get("selectedKarmapoints");this.onAchievedStatus(c,goalOwner,karmapoints,n,k,f,a,h,isManager,ratingText)}else{if(Ext.isEmpty(a)){Ext.Msg.alert("Warning","Please fill comments");return false}Ext.Ajax.request({url:"/goalstatus",method:"PUT",params:{goalId:f,statusId:k,selfComment:a},success:function(e,p){d.getViewModel().set("goalStatus","Completed");d.getViewModel().set("goalStatusIconCls","completed-icon-cls");l.getViewModel().set("isdoneBtnEnable",true);l.getViewModel().set("EmpVisibilityMode",true);l.getViewModel().set("dneBtn",true);d.getViewModel().set("goalFieldReadyOnly",true);l.getViewModel().set("editorOrGridDisable",true);l.getViewModel().set("GridDisable",true);Ext.Msg.alert("Success","Successfully Goal completed")},failure:function(e,p){Ext.Msg.alert("Error","Failed to update the goal status!")}})}},onAchievedStatus:function(i,n,b,a,e,q,r,m,k,g){if(Ext.isEmpty(r)){Ext.Msg.alert("Warning","Please fill comments");return false}var j=Ext.ComponentQuery.query("executiveplanmainview")[0],c=j.getViewModel(),o=Ext.ComponentQuery.query("executiveplanview")[0].getViewModel(),p,d=Ext.getStore("Goals.store.GoalsNotesStore"),f=Ext.getStore("login").getAt(0),h,l;if(m){if(m.rb==2){var h=r;e=5}else{if(m.rb==1){var l=r;e=7}}}p={goalId:q,statusId:e,managerComment:h,cancelReason:l,ratingText:g,karmaPoints:b,noteDetails:r,goalOwner:n,ismanager:k};Ext.Ajax.request({url:"/goalstatus",method:"PUT",params:p,scope:this,success:function(t,s){if(!Ext.isEmpty(l)){c.set("goalStatus","Cancel");c.set("goalStatusIconCls","achieved-icon-cls");Ext.Msg.alert("Status","Goal cancelled")}else{if(!Ext.isEmpty(h)){c.set("goalStatus","Achieved");c.set("goalStatusIconCls","achieved-icon-cls");Ext.Msg.alert("Success","Successfully Goal achieved")}}a.load();d.load({params:{goalid:q}});j.getViewModel().set("goalFieldReadyOnly",true);o.set("editorOrGridDisable",true);o.set("GridDisable",true);o.set("isUpdateNeed",true);o.set("dneBtn",true);o.set("MngrVisibilityMode",true);o.set("EmpVisibilityMode",true);o.set("BtnvisibilityMode",true)},failure:function(v,s){var t=Ext.decode(v.responseText),u=t.message;Ext.Msg.alert("Failed",u)}})},onExecutivePlanApproval:function(c,h){var i,g,n,o,m,f=Ext.ComponentQuery.query("executiveplanmainview")[0],a=f.lookupReference("executiveplanheaderref"),k=Ext.ComponentQuery.query("executiveplanview")[0],l=Ext.ComponentQuery.query("executiveplanform")[0],d=l.down("grid"),j=l.down("button[text=Add New Task]"),b;i=2;m=m;goalnameRef=a.down("textfield[name=goalname]"),targetDtRef=a.down("datefield[name=targetDate]"),parentComboRef=a.down("combo[reference=parentgoalref]"),n=this.getViewModel();execvm=f.getViewModel();b=Ext.getStore("Goals.store.ExecutiveStore");g=n.get("ddo_employeegoal_id");if(n.get("isManager")){i=3}Ext.Ajax.request({url:"/goalstatus",method:"PUT",scope:this,params:{goalId:g,statusId:i,selfComment:"Who am I?",ismanager:n.get("isManager")},success:function(p,q){var e=Ext.decode(p.responseText).reportingto;if(n.get("isManager")){var r=Ext.getStore("karmasetup.wallet.EmployeeComboStore");r.load();Ext.Msg.alert("Success","Successfully Goal approved");f.getViewModel().set("goalStatus","In Progress");f.getViewModel().set("goalStatusIconCls","in-progress-icon-cls");k.getViewModel().set("tab3",false);k.getViewModel().set("tab4",false);k.getViewModel().set("GridDisable",false);k.getViewModel().set("isUpdateNeed",true);k.getViewModel().set("dneBtn",false);k.getViewModel().set("isdoneBtnEnable",true);k.getViewModel().set("EmpVisibilityMode",false);k.getViewModel().set("MngrVisibilityMode",false);k.getViewModel().set("istodoDelete",true);k.getViewModel().set("doneText","Done");Ext.getStore("widget.todo.TodoStore").load()}else{if(e){Ext.Msg.alert("Success","Goal sent for manager approval")}else{Ext.Msg.alert("Success","Your role and reporting-to is not set, please contact Admin")}execvm.set("goalStatus","Pending");execvm.set("goalStatusIconCls","pending-icon-cls");k.getViewModel().set("GridDisable",true)}c.setDisabled(true);k.getViewModel().set("apprvedisabled",true);k.getViewModel().set("BtnvisibilityMode",true);execvm.set("goalFieldReadyOnly",true);k.getViewModel().set("editorOrGridDisable",true);k.getViewModel().set("addTaskDisable",true);b.each(function(s){s.set("deletable",false)})},failure:function(e,p){Ext.Msg.alert("Error!","Failed to update the goal status!")}})},oncheckchange:function(h,i,k,c,d,f){var l=h.up("grid").getStore(),g=l.getAt(i),j=this.getViewModel(),b=j.get("ddo_employeegoal_id"),a;a={taskId:g.data.taskid,iscompleted:(g.data.taskcompleted==true)?"Y":"N",empGoalId:b};Ext.Ajax.request({url:"/goaltask/completetask",method:"PUT",scope:this,params:a,success:function(n,t){var m=Ext.ComponentQuery.query("executiveplanmainview")[0],s=Ext.ComponentQuery.query("executiveplanview")[0],e=m.lookupReference("executiveplanheaderref"),r=0,o=0;l.each(function(v){if(v.data.taskcompleted){r=r+v.data.timerequired}o=o+v.data.timerequired});var u=(r/o);var q=e.down("progressbar");var p=e.down("label");q.setValue(u);p.setHtml(Math.round((u*100),2)+"%");Ext.getBody().unmask();if(u==1){s.getViewModel().set("isdoneBtnEnable",false)}else{s.getViewModel().set("isdoneBtnEnable",true)}},failure:function(m,e){Ext.getBody().unmask()}})},setProgressBarValue:function(){var b=this.getView().down("executiveplanheader");var a=b.down("progressbar").value;var c=b.down("label");if(!a){a=0}c.setHtml(Math.round((a*100),2)+"%")},onGoalsIconRender:function(b){var a=this;b.getEl().on({click:Ext.bind(a.onGoalsIconClick,a,[b])})},onGoalsIconClick:function(b){var a=Ext.ComponentQuery.query("executiveplanview")[0].getViewModel(),c=b.up("container").down("numberfield").getValue();if(a.get("ratingIconsEnable")){a.set("selectedKarmapoints",c);a.set("seletcedRatingText",b.value);if(b.value=="Amazing"){a.set("amziconDisabled",false);a.set("supiconDisabled",true);a.set("goodiconDisabled",true)}if(b.value=="Superb"){a.set("amziconDisabled",true);a.set("supiconDisabled",false);a.set("goodiconDisabled",true)}if(b.value=="Good"){a.set("amziconDisabled",true);a.set("supiconDisabled",true);a.set("goodiconDisabled",false)}}},onradiochange:function(h,c,q,n){var p=Ext.ComponentQuery.query("executiveplanview")[0],o=p.getViewModel();var d=Ext.ComponentQuery.query("executiveplanmainview")[0],a=d.lookupReference("executiveplanheaderref");if(c.rb==1){o.set("isdoneBtnEnable",false)}else{if(c.rb==2){var m=Ext.getStore("Goals.store.ExecutiveStore"),b=m.getData();var k=0,e=0;for(var f=0;f<b.length;f++){if(b.items[f].data.taskcompleted){k=k+b.items[f].data.timerequired}e=e+b.items[f].data.timerequired}var l=b.length;if(l>0){var r=(k/e)}var j=a.down("progressbar");var g=a.down("label");j.setValue(r);g.setHtml(Math.round((r*100),2)+"%");if(r==1){o.set("isdoneBtnEnable",false)}else{o.set("isdoneBtnEnable",true)}}}}});Ext.define("Goals.view.ExecutivePlanView",{extend:"Ext.container.Container",alias:"widget.executiveplanview",cls:"executiveplanview-cls",layout:{type:"fit"},requires:["Goals.view.Notes","Goals.view.RatingForm","Goals.store.RatingStore","Goals.view.ShareGoalsForm","Goals.view.ManagerRatingForm","Goals.view.ExecutivePlanForm","Goals.view.ExecutivePlanViewModel","Goals.view.ExecutivePlanViewController"],controller:"executiveplanview",viewModel:{type:"executiveplanview"},items:[{xtype:"hiddenfield",name:"ddo_employeegoal_id"},{xtype:"tabpanel",cls:"goalstab-cls",items:[{title:"Measurement Criteria",iconCls:"goalmeasurement-icon",width:"100%",bind:{disabled:"{tab1}"},items:[{xtype:"container",width:"99%",margin:"0 5",items:[{xtype:"htmleditor",cls:"goalshtmleditor-cls",name:"measurementCriteria",width:"100%",bind:{disabled:"{editorOrGridDisable}"}},{xtype:"textarea",width:"100%",cls:"employee-setup-txtfield-cls",reference:"commentsref",emptyText:"Comments",bind:{hidden:"{visibilityMode}"}}]},{xtype:"container",layout:{type:"hbox",pack:"center"},style:{"background-color":"#f6f6f6"},items:[{xtype:"button",bind:{text:"{BtnText}",hidden:"{BtnvisibilityMode}"},margin:"30px 10px",cls:"goalhtml-savebtn-cls",listeners:{click:"onMeasurementSave"}},{xtype:"button",reference:"approveBtnRef",bind:{disabled:"{apprvedisabled}",text:"{approveText}",hidden:"{BtnvisibilityMode}"},margin:"30px 10px",statusId:2,cls:"goalhtml-updatebtn-cls",listeners:{click:"onExecutivePlanApproval"}}]}]},{title:"Execution Plan",iconCls:"financeicon-cls",bind:{disabled:"{tab2}"},items:[{xtype:"executiveplanform",width:"100%",reference:"executiveplanformRef"},{xtype:"container",margin:"20 0 0 0",cls:"",layout:{type:"hbox",pack:"center"},style:{"background-color":"#f6f6f6"},items:[{xtype:"button",bind:{text:"{BtnText}",hidden:"{BtnvisibilityMode}"},margin:"30px 10px",reference:"execsavebtnref",cls:"goalhtml-savebtn-cls",listeners:{click:"onExecutivePlanSave"}},{xtype:"button",reference:"execapprovalref",bind:{text:"{approveText}",disabled:"{apprvedisabled}",hidden:"{BtnvisibilityMode}"},margin:"30px 10px",cls:"goalhtml-updatebtn-cls",listeners:{click:"onExecutivePlanApproval"}}]}]},{title:"Share with",iconCls:"usersicon-cls",bind:{disabled:"{tab3}"},items:[{xtype:"container",width:"100%",cls:"ratingdetailcontainer-cls",items:[{xtype:"sharegoalsform",cls:"sharegoalsform-cls"},{xtype:"container",cls:"",layout:{type:"hbox",pack:"center"},items:[{xtype:"button",text:"Update",margin:"30px 10px",listeners:{click:"onShareUpdate"}}]}]}]},{title:"Rating",reference:"ratingref",iconCls:"charticon-cls",bind:{disabled:"{tab4}"},items:[{xtype:"container",layout:"card",items:[{xtype:"managerratingform",width:"100%"},{xtype:"ratingdetails",width:"100%"}]},{xtype:"radiogroup",width:"100%",bind:{hidden:"{MngrVisibilityMode}"},columns:2,vertical:true,items:[{boxLabel:"Cancel Goal",name:"rb",inputValue:"1"},{boxLabel:"Complete",name:"rb",inputValue:"2",checked:true,padding:"0px 0px 0px 10px"}],listeners:{change:"onradiochange"}},{xtype:"textarea",cls:"employee-setup-txtfield-cls",width:"100%",hidden:true,reference:"commentsratingref",emptyText:"Comments",bind:{hidden:"{EmpVisibilityMode}"}},{xtype:"container",margin:"10 0 0 0",layout:{type:"hbox",pack:"center"},items:[{xtype:"button",text:"Move to Drafts",margin:"0px 30px 0px 10px",statusId:6,cls:"ratingsavebtn",scale:"large",bind:{hidden:"{isUpdateNeed}"},handler:"onDraftsBtnClick"},{xtype:"button",text:"Approve",scale:"large",statusId:3,cls:"ratingsavebtn",bind:{hidden:"{isUpdateNeed}"},style:{"background-color":"#f6f6f6"},margin:"0px 20px 0px 5px",handler:"onApproveBtnClick"},{xtype:"button",reference:"dnebtnref",scale:"large",statusId:4,bind:{text:"{doneText}",hidden:"{dneBtn}",disabled:"{isdoneBtnEnable}"},margin:"0px 30px 0px 10px",cls:"goalhtml-savebtn-cls",handler:"onCompleteBtnClick"}]}]},{title:"Notes",bind:{disabled:"{tab5}"},width:"100%",items:[{xtype:"container",width:"100%",items:[{xtype:"tbfill",width:150},{xtype:"notes",width:"100%"},{xtype:"button",text:"&#x271B",cls:"fab-button",listeners:{click:"onAddNewClick"}}]}]}]}]});Ext.define("Goals.view.ExecutivePlanMainViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.executiveplanmainview",data:{goalStatus:null,goalStatusIconCls:null,goalFieldReadyOnly:false}});Ext.define("Goals.view.ExecutivePlanMain",{extend:"Ext.container.Container",alias:"widget.executiveplanmainview",requires:["Goals.view.goals.GoalsView","Goals.view.ExecutivePlanView","Goals.view.ExecutivePlanHeader","Goals.view.ExecutivePlanMainViewModel"],cls:"exe-plan-mainview-cls",height:"100%",width:"100%",controller:"executiveplanview",viewModel:{type:"executiveplanmainview"},items:[{xtype:"toolbar",docked:"top",cls:"exe-plan-toolbar",layout:{type:"hbox"},items:[{xtype:"button",scale:"large",iconCls:"goalsbackbtn-cls",cls:"back-btn-cls",handler:"onBackButtonClick"},"->",{xtype:"button",scale:"large",bind:{text:"{goalStatus}",iconCls:"{goalStatusIconCls}"},cls:"achieved-btn-cls"}]},{xtype:"executiveplanheader",reference:"executiveplanheaderref"},{xtype:"executiveplanview",reference:"executiveplanviewref"}]});Ext.define("Goals.view.RatingDetails",{extend:"Ext.container.Container",alias:"widget.ratingdetails",items:[{xtype:"container",width:"100%",height:150,cls:"ratingdetails-cls",style:{backgroundSize:"100% 100% !important",background:'url("/resources/images/goals/Achieved_Banner.png") 0/cover no-repeat !important'}},{xtype:"container",padding:15,style:{transform:"translate(0px, -68px)"},layout:{type:"vbox",pack:"center",align:"middle"},items:[{xtype:"image",style:{background:"#fff","border-radius":"9px","box-shadow":"1px 3px 7px 3px #dfdfe0"},padding:10,src:"resources/images/goals/amazing.png"},{padding:10,bind:{html:'<div><span style="color:#aeaeae;font-size:12px;">{achievedratingText} |</span> <b><span class="karma-score-icon"></span> {achievedKarmaPoints}</b></div>'}}]},{xtype:"dataview",reference:"selfcommentsref",tpl:['<div style="width:100%;background-color:#FFFF;">','<tpl for=".">','<div style = "color:#fab82e;font-weight:600;font-size:14;">Self Comments: </div></br>',"<div>{selfcomment}</div></br>",'<div style = "color:#fab82e;font-weight:600;font-size:14;">Manager Comments: </div></br>',"<div>{managercomment}</div></br>","</tpl>","<div>"],itemSelector:""}]});Ext.define("Goals.view.Test",{extend:"Ext.window.Window",alias:"widget.goals-test",width:"90%",height:580,modal:true,draggable:false,resizable:false,cls:"redeem-view",title:"Test",items:[{xtype:"container",width:"100%",height:"100%",layout:{type:"hbox"},items:[{xtype:"button",text:"Testing View"}]}]});Ext.define("Goals.view.goals.CreateGoalHeader",{extend:"Ext.form.Panel",alias:"widget.creategoalheader",initComponent:function(){Ext.getStore("Goals.store.goals.ProjectStore").load();this.callParent(arguments)},cls:"goals-detail-headerview-cls",width:"100%",height:"100%",items:[{xtype:"container",layout:"hbox",cls:"goals-details-headerview-top",defaults:{margin:"0 0 5 0"},items:[{xtype:"button",cls:"goals-back-btn-cls",iconCls:"goals-back-icon"},{xtype:"tbfill"},{xtype:"button",text:"Draft",cls:"goals-status-button",iconCls:"x-fa fa-pencil-square-o"}]},{xtype:"container",layout:"column",defaults:{margin:"10 20 0 0",labelSeparator:""},items:[{xtype:"textfield",emptyText:"Design Ui/Ux for DDO Mobile",columnWidth:"0.7"},{xtype:"label",html:"Progress",columnWidth:"0.07",margin:"20 0 0 0"},{xtype:"progressbar",columnWidth:0.2,height:14,value:"0.2",ui:"progressui",margin:"20 0 0 0"},{xtype:"label",html:"20%",columnWidth:"0.03",margin:"20 0 0 0"},{xtype:"combobox",emptyText:"Project",columnWidth:"0.7",store:"Goals.store.goals.ProjectStore",displayField:"name",valueField:"value",cls:"select-project-cls"},{xtype:"datefield",fieldLabel:"Target Date",name:"from_date",value:new Date(),format:"d-m-Y",columnWidth:"0.25"}]}]});Ext.define("Goals.view.goals.GoalsAccountView",{extend:"Ext.view.View",alias:"widget.goalsaccountview",requires:["Goals.view.goals.SearchGoalViewController"],initComponent:function(){Ext.getStore("Goals.store.goals.GoalsViewStore").load();this.callParent(arguments)},loadMask:false,controller:"goalscontroller",store:"Goals.store.goals.GoalsViewStore",tpl:['<tpl for=".">','<tpl if="xindex === 1">','<div class="create-goal-cls">','<div class="create-goal-plus-icon"><span class="plus-icon"></span></div>','<div class="create-goal-text">Create Goal</div>',"</div>","</tpl>","</tpl>"],itemSelector:".create-goal-cls"});Ext.define("Goals.view.goals.GoalsDetailView",{extend:"Ext.container.Container",alias:"widget.goalsdetailview",requires:["Goals.view.goals.CreateGoalHeader"],cls:"goals-dashboard-detailview-cls",height:"100%",width:"100%",items:[{xtype:"creategoalheader"},{xtype:"executiveplanview"}]});Ext.define("Goals.view.goals.SearchFilterWindowController",{extend:"Ext.app.ViewController",alias:"controller.searchfilterwindowcontroller",onWindowOutsideTap:function(d,e){var a=this,c=Ext.ComponentQuery.query("searchfilterwindow")[0]||Ext.create("Goals.view.goals.SearchFilterWindow"),b=c.down("form");if(!b.isDirty()){if(Utility.nominatAlert){Utility.onWindowOutterTap(d,e,a)}}},onGoalsFliter:function(h,s,a,f){var b=h.up("window").down("form"),l=b.getValues(),t=this.getViewModel(),o=h.up("window").down("datefield").getValue(),g=Ext.getStore("Goals.store.goals.GoalsViewStore"),d=h.up("window").down("buttongroup");var n=Ext.ComponentQuery.query("goalsheader")[0],p=n.down("combobox[reference = comboref]"),r=p.getStore().findRecord("value",p.getValue()),k;if(r==null){k=Ext.ComponentQuery.query("combobox[name=goaltypecombo]")[1];r=p.getStore().findRecord("value",k.getValue())}var c=Ext.getStore("login").getData(),i=c.items[0].data.ddo_employee_id;var q=[];d.items.items.forEach(function(e){if(e.pressed){q.push(e.text)}});t.set("filterView",true);if(g){g.clearFilter(true);g.filterBy(function(x){var v=false,w=false,A=false,z=false,y=false;if(Ext.isEmpty(l.people_tag)||(l.people_tag.indexOf(x.data.goalUser.employeeId)!=-1)){v=true}if(Ext.isEmpty(q)||(q.indexOf(x.data.goalstatus)!=-1)){z=true}var e=x.data.title.search(new RegExp(l.goal,"gi"));if(Ext.isEmpty(r)||(r.data.key==x.data.goalType)){if((r.data.key=="Shared")&&(x.data.goalUser.employeeId==i)){A=false}else{A=true}}else{if((r.data.key=="All")&&x.data.goalAllView){A=true}else{if(x.data.goalType=="Shared"){if((r.data.key=="Personal")&&(x.data.goalUser.employeeId==i)){A=true}else{A=false}}}}if(Ext.isEmpty(o)||(Ext.Date.diff((new Date(x.data.targetdate)),o,Ext.Date.DAY)>=0)){y=true}return e>=0&&v&&z&&A&&y},this)}if(!f){var j=h.up("window"),b=j.down("form"),u=n.down("button[reference=searchfiltericon]"),m=n.down("label[reference=clearfilterRef]");if(b.isDirty()||!Ext.isEmpty(q)){if(m.hasCls("x-hidden")){m.removeCls("x-hidden")}j.hide()}else{if(!m.hasCls("x-hidden")){m.addCls("x-hidden")}Ext.Msg.alert("Error","Atleast one parameter should be selected for filtering.")}}},onDraft:function(b,c,a){if(b.pressed){b.removeCls("goals-btn-cls");b.addCls("pressedBtnCls")}else{b.removeCls("pressedBtnCls");b.addCls("goals-btn-cls")}}});Ext.define("Goals.view.goals.SearchFilterWindowViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.searchfilterwindowviewmodel",data:{filterView:false}});Ext.define("Goals.view.goals.SearchFilterWindow",{extend:"Ext.window.Window",alias:"widget.searchfilterwindow",requires:["Goals.view.goals.SearchFilterWindowController","Goals.view.goals.SearchFilterWindowViewModel","Ext.form.field.Date","Ext.container.ButtonGroup"],controller:"searchfilterwindowcontroller",viewModel:{type:"searchfilterwindowviewmodel"},cls:"momwindow-cls",modal:true,resizable:false,width:600,maxHeight:600,header:true,closable:true,listeners:{close:function(a){a.down("form").reset()}},initComponent:function(){this.callParent(arguments);var b=Ext.getStore("feeds.Groups");if(!b.isLoaded()){b.load()}var a=this.getController();Ext.getDoc().on("click",Ext.bind(a.onWindowOutsideTap,a))},destroy:function(){var a=this.getController();Ext.getDoc().un("click",Ext.bind(a.onWindowOutsideTap,a))},items:[{xtype:"form",width:"100%",height:"100%",bodyPadding:"10 10",layout:{type:"vbox"},bbar:{cls:"goal-bbar-cls ",height:60,items:[{xtype:"label",cls:"goal-dt-label-cls ",text:"Date : "},{xtype:"datefield",width:172,cls:"goal-date-cls",editable:false,required:true,alwaysOnTop:true,name:"start_date",disabledCls:"notestatus-item-disabled",reference:"fromDate",emptyText:"YYYY-MM-DD",format:"Y-m-d",createPicker:function(){var a=this,b=Ext.String.format;return Ext.create("Ext.picker.Date",{pickerField:a,ownerCt:a.ownerCt,renderTo:document.body,floating:true,hidden:true,focusOnShow:true,cls:"ddo-create-datepicker",minDate:a.minValue,maxDate:a.maxValue,disabledDatesRE:a.disabledDatesRE,disabledDatesText:a.disabledDatesText,disabledDays:a.disabledDays,disabledDaysText:a.disabledDaysText,format:a.format,showToday:a.showToday,startDay:a.startDay,minText:b(a.minText,a.formatDate(a.minValue)),maxText:b(a.maxText,a.formatDate(a.maxValue)),listeners:{scope:a,select:a.onSelect},keyNavConfig:{esc:function(){a.collapse()}}})}},{xtype:"tbfill"},{xtype:"button",formBind:true,reference:"filtersearchbtn",width:10,height:10,cls:"search-icon-field",listeners:{click:"onGoalsFliter"}}]},items:[{xtype:"textfield",name:"goal",required:true,emptyText:"Goal Name"},{xtype:"tagfield",reference:"comboTagview",matchFieldWidth:false,name:"people_tag",hideTrigger:true,width:"100%",cls:"share-group-cls",forceSelection:false,store:"feeds.Groups",emptyText:"Search People",displayField:"tagName",valueField:"tagId",disabledCls:"mom-item-disabled",bind:{value:"{tagId}"},queryMode:"local",filterPickList:true,listConfig:{cls:"tag-view-list",width:300},tpl:['<ul class="x-list-plain"><tpl for=".">','<li role="option" class="x-boundlist-item">','<tpl if="values.isGroup">','<span class="ddo-groupTag-round">{[this.getGroupTags(values)]}</span>',"{tagName}</tpl>",'<tpl else if="!values.isGroup">','<div class="ddo-tag-round">{[this.getTags(values)]}</div>','<div class="ddo-tag-Name">{tagName}</div></tpl></li></tpl>',"</ul>",{getGroupTags:function(a){if(typeof(a)==="object"){if(a.isGroup){return a.tagName[0]}}},getTags:function(a){if(typeof(a)==="object"){if(!a.isGroup){if(a.tagPic){return'<img class="tagUrl-img"  src="'+a.tagPic+'" >'}}}}}],listeners:{select:function(c,a,b){c.inputEl.dom.value="";c.collapse()}}},{xtype:"buttongroup",reference:"btnGrpRef",columns:6,cls:"btn-grp-cls",bodyPadding:"10 0 3 0",defaults:{cls:"goals-btn-cls",enableToggle:true,width:88,height:35,margin:4},items:[{text:"Draft",listeners:{click:"onDraft"}},{text:"Pending",listeners:{click:"onDraft"}},{text:"In Progress",listeners:{click:"onDraft"}},{text:"Completed",listeners:{click:"onDraft"}},{text:"Cancel",listeners:{click:"onDraft"}},{text:"Achieved",listeners:{click:"onDraft"}}]}]}]});Ext.define("Goals.view.goals.GoalsHeader",{extend:"Ext.panel.Panel",alias:"widget.goalsheader",requires:["Goals.store.goals.GoalsStore","Goals.view.goals.SearchFilterWindow"],initComponent:function(){Ext.getStore("Goals.store.goals.GoalsViewStore").load();Ext.getStore("Goals.store.goals.GoalsStore").load();this.callParent(arguments)},layout:{type:"hbox",align:"middle"},defaultButton:"search",cls:"goals-headerview-cls",defaults:{margin:"0 0 20 0"},items:[{xtype:"button",width:6,cls:"goals-search-icon",height:6},{xtype:"textfield",cls:"search-field-cls",width:"40%",emptyText:"Search Goals",handleMouseEvents:true,listeners:{render:function(a){a.getEl().on("click","onSearchGoalFliter")}}},{xtype:"button",cls:"goals-search-btn-cls ",iconCls:"goals-search-btn-icon",reference:"searchfiltericon",listeners:{click:"onSearchGoalFliter"}},{xtype:"label",html:"Clear Filters",name:"goallabelfilter",reference:"clearfilterRef",cls:"clearfilter-cls x-hidden",listeners:{afterrender:"onLabelFocus"}},{xtype:"tbfill"},{xtype:"combobox",store:"Goals.store.goals.GoalsStore",displayField:"name",name:"goaltypecombo",valueField:"value",editable:false,reference:"comboref",cls:"select-goals-cls",listeners:{afterrender:"oncomborender",change:"onComboSelect"}}]});Ext.define("Goals.view.goals.GoalsMainView",{extend:"Ext.panel.Panel",alias:"widget.goalsmainview",requires:["Goals.view.RatingDetails","Goals.view.goals.GoalsView","Goals.view.goals.GoalsHeader"],controller:"searchgoalviewcontroller",cls:"goals-dashboard-mainview-cls",width:"100%",height:"100%",layout:{type:"fit"},tbar:{xtype:"goalsheader"},items:[{xtype:"goalsview"}]});Ext.define("Goals.view.goals.GoalsNoteWindowController",{extend:"Ext.app.ViewController",alias:"controller.goalsnotewindowcontroller",onWindowOutsideTap:function(d,e){var a=this,c=Ext.ComponentQuery.query("searchfilterwindow")[0]||Ext.create("Goals.view.goals.SearchFilterWindow"),b=c.down("form");if(!b.isDirty()){if(Utility.nominatAlert){Utility.onWindowOutterTap(d,e,a)}}},onFormCancelClick:function(b,f,a){var d,c;d=b.up("window");c=d.down("form");c.reset();d.close()},onFormSaveClick:function(b,i,j){var h=b.up("window"),a=h.down("form"),g=Ext.getStore("Goals.store.GoalsNotesStore"),f=a.getValues(),m=Ext.ComponentQuery.query("executiveplanview")[0],d=Ext.ComponentQuery.query("executiveplanmainview")[0],l=m.getViewModel(),c=l.get("ddo_employeegoal_id");params={goalid:c,type:"Standard",details:f.details};var k={details:f.details,notetype:"Standard",targetdate:new Date()};Ext.Ajax.request({url:"/goalnote",method:"POST",params:params,success:function(n,e){Ext.getBody().unmask();g.add(k)},failure:function(n,e){Ext.getBody().unmask()}});h.close()}});Ext.define("Goals.view.goals.GoalsNoteWindowViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.goalsnotewindowviewmodel"});Ext.define("Goals.view.goals.GoalsNoteWindow",{extend:"Ext.window.Window",requires:["Goals.view.goals.GoalsNoteWindowController","Goals.view.goals.GoalsNoteWindowViewModel"],alias:"widget.goalsnotewindow",title:"Add Notes",controller:"goalsnotewindowcontroller",viewModel:{type:"goalsnotewindowviewmodel"},modal:true,initComponent:function(){this.callParent(arguments);var b=Ext.getStore("Goals.store.goals.GoalsStatusComboStore");if(b&&!b.isLoaded()){b.load()}var a=this.getController();Ext.getDoc().on("click",Ext.bind(a.onWindowOutsideTap,a))},destroy:function(){var a=this.getController();Ext.getDoc().un("click",Ext.bind(a.onWindowOutsideTap,a))},listeners:{show:function(b,a){b.center()}},width:600,height:300,items:[{xtype:"form",bbar:{layout:{type:"hbox"},padding:"25 0 21 0",items:[{xtype:"button",text:"Cancel",cls:"karmaform-cancel-btn",listeners:{click:"onFormCancelClick"}},{xtype:"button",text:"Save",cls:"karmaform-save-btn",formBind:true,listeners:{click:"onFormSaveClick"}}]},items:[{xtype:"textarea",name:"details",emptyText:"Details",cls:"rule-name-cls"}]}]});Ext.define("Goals.view.goals.Main",{extend:"Ext.container.Container",alias:"widget.goals-main",requires:["Goals.view.goals.GoalsView","Goals.view.ExecutivePlanMain","Goals.view.ExecutivePlanView","Goals.view.goals.GoalsMainView"],initComponent:function(){var a=this;Ext.apply(a,{layout:"card",activeItem:1,height:700,items:[{xtype:"executiveplanmainview"},{xtype:"goalsmainview"}]});a.callParent(arguments)}});Ext.define("Goals.view.goals.SearchGoalViewModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.searchgoalviewmodel"});